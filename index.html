<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NotebookLM 簡報修改神器 - 輕鬆修改 PDF 簡報內容。上傳 PDF，智能辨識，即時編輯，一鍵下載。">
    <meta name="keywords" content="NotebookLM, PDF編輯器, 簡報編輯, OCR, 文字辨識">
    <title>NotebookLM 簡報修改神器 | 輕鬆修改 PDF 簡報內容</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">
                    <span class="logo-bracket">[</span>
                    <span class="logo-n">N</span>
                    <span class="logo-bracket">]</span>
                </div>
                <h1 class="logo-text">
                    <span class="logo-title">NotebookLM</span>
                    <span class="logo-subtitle">簡報修改神器</span>
                </h1>
            </div>

            <!-- Header 功能區 -->
            <div class="header-actions" id="headerActions">
                <button class="help-btn" id="helpBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    使用說明
                </button>
                <button class="import-pdf-btn" id="importPdfBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                    匯入 PDF
                </button>
                <button class="export-pdf-btn" id="exportPdfBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                    匯出 PDF
                </button>
            </div>
        </div>
    </header>

    <!-- Main App Section -->
    <main class="main-app" id="app-section">
        <div class="app-container">
            <!-- Subtitle -->


            <!-- Auth Section 已移除，無需登入 -->

            <!-- Editor Section (登入後顯示) -->
            <div class="editor-section hidden" id="editorSection">
                <!-- Upload Area -->
                <div class="upload-area" id="uploadArea">
                    <div class="upload-content">
                        <svg class="upload-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="17 8 12 3 7 8" />
                            <line x1="12" y1="3" x2="12" y2="15" />
                        </svg>
                        <p class="upload-text">點擊或拖曳檔案上傳</p>
                        <p class="upload-hint">支援 PDF 格式，無頁數限制</p>
                    </div>
                    <input type="file" id="fileInput" accept=".pdf" hidden>
                </div>

                <!-- Processing State -->
                <div class="processing-area hidden" id="processingArea">
                    <div class="spinner"></div>
                    <p class="processing-text">正在載入 PDF，請稍候...</p>
                    <p class="processing-progress">處理頁面 <span id="currentPage">0</span>/<span id="totalPages">0</span>
                    </p>
                </div>

                <!-- Page Thumbnails (上傳後的頁面選取) -->
                <div class="thumbnails-area hidden" id="thumbnailsArea">
                    <h3 class="thumbnails-title">請點選要修改的頁面，按「開始編輯」進入編輯模式</h3>
                    <div class="thumbnails-grid" id="thumbnailsGrid">
                        <!-- 縮圖會動態生成 -->
                    </div>
                </div>

                <!-- Editor Canvas - 三欄佈局 -->
                <div class="editor-layout hidden" id="editorLayout">
                    <div class="editor-header">

                        <h3 class="canvas-title">編輯模式</h3>
                    </div>

                    <div class="editor-content editor-three-column">
                        <!-- 左側：頁面導航區（縮圖） -->
                        <div class="page-navigator" id="pageNavigator">
                            <div class="nav-header">
                                <h4>頁面</h4>
                            </div>
                            <div class="page-thumbnails-list" id="pageThumbnailsList">
                                <!-- 動態生成頁面縮圖 -->
                            </div>
                        </div>

                        <!-- 中央：PDF 預覽與編輯區 -->
                        <div class="editor-center">
                            <!-- 縮放工具列 -->
                            <div class="zoom-toolbar" id="zoomToolbar">
                                <button class="zoom-btn" id="zoomOut" title="縮小">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8" />
                                        <line x1="8" y1="11" x2="14" y2="11" />
                                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                    </svg>
                                </button>
                                <span class="zoom-level" id="zoomLevel">100%</span>
                                <button class="zoom-btn" id="zoomIn" title="放大">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8" />
                                        <line x1="11" y1="8" x2="11" y2="14" />
                                        <line x1="8" y1="11" x2="14" y2="11" />
                                        <line x1="21" y1="21" x2="16.65" y2="16.65" />
                                    </svg>
                                </button>
                                <div class="toolbar-divider"></div>
                                <button class="zoom-btn" id="undoBtn" title="上一步 (Ctrl+Z)" disabled>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 7v6h6" />
                                        <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13" />
                                    </svg>
                                </button>
                                <button class="zoom-btn" id="redoBtn" title="下一步 (Ctrl+Y)" disabled>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 7v6h-6" />
                                        <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 3.7" />
                                    </svg>
                                </button>
                                <button class="zoom-btn" id="zoomReset" title="重置縮放">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                                    </svg>
                                </button>
                                <div class="toolbar-divider"></div>
                                <button class="zoom-btn" id="addCoverBtn" title="新增覆蓋遮罩 (純色塊)">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                                        <line x1="3" y1="3" x2="21" y2="21" />
                                    </svg>
                                </button>
                                <button class="zoom-btn" id="addHTextBtn" title="新增橫向文字">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M4 7V4h16v3" />
                                        <path d="M9 20h6" />
                                        <path d="M12 4v16" />
                                    </svg>
                                </button>
                                <button class="zoom-btn" id="addVTextBtn" title="新增直向文字">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M17 4h-3v16h3" />
                                        <path d="M4 9v6" />
                                        <path d="M20 12H4" />
                                    </svg>
                                </button>
                                <span class="zoom-hint">Ctrl+滾輪縮放 / 右鍵拖曳移動</span>
                            </div>

                            <!-- 可拖曳的預覽區域 -->
                            <div class="pdf-viewport" id="pdfViewport">
                                <div class="pdf-preview-container" id="pdfPreviewContainer">
                                    <canvas id="editorCanvas"></canvas>
                                    <div class="text-overlays" id="textOverlays"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 右側：辨識結果面板 -->
                        <div class="editor-right">
                            <div class="result-panel">
                                <div class="result-header">
                                    <h4>修改區域</h4>
                                    <button class="action-btn-outline" id="toggleVisibility" title="切換編輯框顯示狀態">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                            <circle cx="12" cy="12" r="3" />
                                        </svg>
                                        <span>隱藏編輯框</span>
                                    </button>
                                </div>

                                <div class="result-hint">
                                    <span class="hint-icon">🖌️</span>
                                    <span>拖曳框選要覆蓋文字的區域</span>
                                </div>

                                <!-- 文字區域列表 -->
                                <div class="text-list" id="textList">
                                    <!-- 動態生成 -->
                                </div>

                                <div class="panel-stats"
                                    style="text-align: right; padding: 0 4px; margin-bottom: 8px; font-size: 0.85em; color: #6b7280;">
                                    共 <span id="textBoxCount">0</span> 個區域
                                </div>

                                <!-- 下載區域 -->
                                <div class="download-section">
                                    <button class="download-btn" id="downloadBtn">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                                            <polyline points="7 10 12 15 17 10" />
                                            <line x1="12" y1="15" x2="12" y2="3" />
                                        </svg>
                                        匯出 PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
        <p class="toast-message" id="toastMessage"></p>
    </div>

    <!-- 編輯對話框 -->
    <div class="edit-modal hidden" id="editModal">
        <div class="edit-modal-content">
            <div class="edit-modal-header">
                <h4>編輯文字</h4>
                <button class="close-modal-btn" id="closeModalBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="edit-modal-body">
                <label>原始文字：</label>
                <p class="original-text" id="originalText"></p>
                <label>修改為：</label>
                <textarea id="editTextarea" rows="3"></textarea>

                <!-- 字體樣式設定 -->
                <div class="style-options">
                    <div class="style-row">
                        <label>字體大小：</label>
                        <input type="range" id="fontSizeSlider" min="12" max="150" value="24">
                        <span id="fontSizeValue">24px</span>
                    </div>
                    <div class="style-row">
                        <label>文字顏色：</label>
                        <input type="color" id="textColorPicker" value="#000000">
                        <button type="button" id="pickTextColorBtn" class="pick-color-btn" title="從圖片吸取顏色">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16"
                                height="16">
                                <path d="M12 2v6m0 8v6M2 12h6m8 0h6" />
                            </svg>
                        </button>
                    </div>
                    <div class="style-row">
                        <label>背景顏色：</label>
                        <input type="color" id="bgColorPicker" value="#f0f0f0">
                        <button type="button" id="pickBgColorBtn" class="pick-color-btn" title="從圖片吸取顏色">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16"
                                height="16">
                                <path d="M12 2v6m0 8v6M2 12h6m8 0h6" />
                            </svg>
                        </button>
                    </div>
                    <div class="style-row">
                        <label>粗體：</label>
                        <input type="checkbox" id="boldCheckbox" checked>
                        <span style="margin-left: 4px;">強制粗體</span>
                    </div>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="cancel-btn" id="cancelEditBtn">取消</button>
                <button class="save-btn" id="saveEditBtn">儲存</button>
            </div>
        </div>
    </div>

    <!-- 使用說明 Modal -->
    <div class="edit-modal-backdrop hidden" id="helpModal">
        <div class="edit-modal" style="width: 800px; max-width: 95vw;">
            <div class="edit-modal-header">
                <h3>使用說明</h3>
                <button class="close-modal-btn" id="closeHelpBtn">&times;</button>
            </div>
            <div class="edit-modal-content"
                style="padding: 24px; line-height: 1.7; color: var(--text-primary); max-height: 70vh; overflow-y: auto;">

                <!-- 特色強調區 -->
                <div class="feature-highlight"
                    style="background: linear-gradient(to right, #f0f9ff, #e0f2fe); border-left: 4px solid var(--color-primary); padding: 16px 20px; border-radius: 0 8px 8px 0; margin-bottom: 24px;">
                    <h3
                        style="color: var(--color-primary); margin: 0 0 12px 0; font-size: 1.25em; display: flex; align-items: center; gap: 8px;">
                        <span>🚀</span> 為什麼選擇簡報修改神器？
                    </h3>
                    <ul style="margin: 0; padding-left: 20px; color: #0369a1;">
                        <li style="margin-bottom: 6px;"><strong>智能背景還原</strong>：修改文字時自動偵測背景色並產生遮罩，無痕覆蓋舊內容。</li>
                        <li style="margin-bottom: 6px;"><strong>直排文字支援</strong>：完美支援中文直式書寫，排版更靈活。</li>
                        <li style="margin-bottom: 0;"><strong>浮水印移除</strong>：利用「新增遮罩」功能，輕鬆遮蓋頁面上的 Logo 或 unwanted
                            objects。</li>
                    </ul>
                </div>

                <div class="help-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">

                    <!-- 核心功能區 -->
                    <div class="help-section">
                        <h4
                            style="color: var(--text-primary); margin-bottom: 12px; font-size: 1.1em; border-bottom: 1px solid var(--border-light); padding-bottom: 8px; font-weight: 600;">
                            �️ 功能操作指南
                        </h4>

                        <div style="margin-bottom: 16px;">
                            <strong style="color: var(--color-primary); display: block; margin-bottom: 4px;">1.
                                修改現有文字</strong>
                            <p style="margin: 0 0 8px 0; font-size: 0.95em; color: var(--text-secondary);">
                                直接在頁面上<strong>框選舊文字</strong>，AI 辨識後即可修改。系統會自動蓋住舊字並疊上新字。</p>
                            <div
                                style="font-size: 0.85em; background: #fff1f2; color: #be123c; padding: 4px 8px; border-radius: 4px; display: inline-block;">
                                注意：修改模式產生的遮罩是固定的，移動時只有文字會動。</div>
                        </div>

                        <div style="margin-bottom: 16px;">
                            <strong style="color: var(--color-primary); display: block; margin-bottom: 4px;">2. 新增物件 (T
                                / [ ])</strong>
                            <ul style="padding-left: 20px; margin: 0; font-size: 0.95em; color: var(--text-secondary);">
                                <li style="margin-bottom: 4px;"><strong>新增文字</strong>：點擊 <span
                                        style="background:var(--bg-secondary); padding:2px 6px; border-radius:4px;">T</span>，輸入文字（背景透明）。
                                </li>
                                <li style="margin-bottom: 4px;"><strong>新增遮罩</strong>：點擊 <span
                                        style="background:var(--bg-secondary); padding:2px 6px; border-radius:4px;">[
                                        ]</span>，產生純色塊（無文字）。</li>
                                <li style="margin-bottom: 4px;"><strong>自由移動</strong>：以上兩者皆為「自由物件」，背景與文字一體成型，拖曳時一起移動。
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- 進階技巧區 -->
                    <div class="help-section">
                        <h4
                            style="color: var(--text-primary); margin-bottom: 12px; font-size: 1.1em; border-bottom: 1px solid var(--border-light); padding-bottom: 8px; font-weight: 600;">
                            🖱️ 進階技巧
                        </h4>

                        <ul style="padding-left: 20px; margin: 0; color: var(--text-secondary);">
                            <li style="margin-bottom: 10px;">
                                <strong>精準吸色</strong>：點擊編輯框內的 <span style="color:var(--color-primary);">[+]吸管</span>，按住
                                <code>Ctrl + 滾輪</code> 放大圖片可精確吸取單一像素顏色，解決色差問題。
                            </li>
                            <li style="margin-bottom: 10px;">
                                <strong>尺寸與字級</strong>：
                                <ul style="margin-top: 4px; color: #4b5563;">
                                    <li><strong>橫排</strong>：拉高框框會放大字體。</li>
                                    <li><strong>直排</strong>：拉寬框框會放大字體；拉高框框只會增加排版長度（字不變大）。</li>
                                </ul>
                            </li>
                            <li style="margin-bottom: 20px;"><strong>鍵盤操作</strong>：支援 <code>Ctrl+Z</code>
                                (復原)、<code>Delete</code> (刪除)、<code>方向鍵</code> (微調位置)。</li>

                            <li style="margin-bottom: 0;"><strong>預覽模式</strong>：點擊右側列表上方的 <span
                                    style="border:1px solid var(--color-primary); color:var(--color-primary); padding:1px 4px; border-radius:3px; font-size:0.85em;">隱藏編輯框</span>
                                按鈕，檢視最終修改效果。</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="edit-modal-footer">
                <button class="save-btn" id="closeHelpBtnBottom">我知道了</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.1.1/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="app.js?v=2.0"></script>
</body>

</html>